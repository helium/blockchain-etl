%% -*- erlang -*-
{erl_opts,
 [
  debug_info,
  {parse_transform, lager_transform}
  %% warnings_as_errors
 ]}.

{shell,
 [
  {apps, [lager]}
 ]}.


{deps,
 [
  lager,
  recon,
  jsone,
  {epgsql, "4.3.0"},
  {observer_cli, "1.5.0"},
  {telemetry, "0.4.1"},
  {envloader, {git, "https://github.com/nuex/envloader.git", {branch, "master"}}},
  {psql_migration, {git, "https://github.com/helium/psql-migration.git", {branch, "master"}}},
  {clique, {git, "https://github.com/helium/clique.git", {branch, "develop"}}},
  {blockchain, {git, "https://github.com/helium/blockchain-core.git", {branch, "adt/resync-on-missing-ledger"}}}
 ]}.

{xref_checks,
 [
  undefined_function_calls,
  undefined_functions
 ]}.

{shell, [{apps, [lager, envloader, epgsql]}]}.

{relx,
 [
  {release, {blockchain_etl, "0.1.0"},
   [
    blockchain_etl
   ]},

  {vm_args, "./config/vm.args"},
  {sys_config, "./config/sys.config"},

  {extended_start_script, true},
  {include_src, true},

  {overlay,
   [
    {copy, "migrations/*.sql", "migrations/"},
    {copy, "./_build/default/bin/psql_migration", "bin/psql_migration"},
    {copy, "priv/genesis", "update/genesis"},
    {copy, "scripts/extensions/genesis", "bin/extensions/genesis"},
    {copy, "scripts/extensions/info", "bin/extensions/info"},
    {copy, "./_build/default/lib/blockchain/scripts/extensions/peer", "bin/extensions/peer"},
    {copy, "./_build/default/lib/blockchain/scripts/extensions/ledger", "bin/extensions/ledger"},
    {copy, "./_build/default/lib/blockchain/scripts/extensions/trace", "bin/extensions/trace"},
    {copy, "./_build/default/lib/blockchain/scripts/extensions/txn", "bin/extensions/txn"}
   ]},
  {extended_start_script_hooks,
   [
    {post_start,
     [
      {wait_for_process, blockchain_worker}
     ]}
   ]},
  {extended_start_script_extensions,
   [
    {genesis, "extensions/genesis"},
    {info, "extensions/info"},
    {peer, "extensions/peer"},
    {ledger, "extensions/ledger"},
    {trace, "extensions/trace"},
    {txn, "extensions/txn"}
   ]}
 ]}.

{profiles,
 [
  {prod,
   [
    {relx, [{dev_mode, false},
            {include_erts, true}]}
   ]}
 ]}.
